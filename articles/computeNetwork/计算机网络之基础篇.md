### 计算机网络
看下面文章前，可先思考几个问题：
+ 本地网和外网如何接通？
+ 在成千上万的计算机中，一台计算机是如何正确找到另一台计算机，并把数据传递给它的呢？

#### 计算机网络是什么？
>计算机网络是指将地理位置不同的具有独立功能的多台计算机及其外部设备，通过通信线路连接起来，在网络操作系统，网络管理软件及网络通信协议的管理和协调下，实现资源共享和信息传递的计算机系统。
 
+ 基于互联网数据传输的分层模型，逐层由上至下。

+ 标准OSI(开放式系统互联通信参考模型)七层模型，分别为： 应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。

![七层模型图-介绍](https://upload-images.jianshu.io/upload_images/2179030-3694fe2b18ebe05f.png?imageMogr2/auto-orient/strip|imageView2/2/w/960/format/webp)

+ 在实际应用中是分为五层：应用层、传输层、网络层、数据链路层、物理层


#### 相隔几千公里的两台计算机，是如何进行数据传输的？
**传递过程如下：**
+ 将数据处理为0、1这样的电信号，通过物理设备（光纤、无线电等）传输给数据链路层。

#### 如何识别这样的电信号？
+ 数据链路层接收到电信号后，根据制定的传输规则，传递给网络层。
    + 以太网规定，一组电信号为一个数据包，数据包称之为帧
    + 帧由标头和数据两部分组成，一个帧的最大长度为1518个字节，最小长度为64字节
    + 标头字节固定18字节
    + 标头内容有发送者和接受者(双方的IP地址)等信息，数据则是具体的传输内容
#### 发送者和接收者如何标识？
+ 计算机之间的数据传送，通过MAC地址来唯一寻找、传送。
    + 以太网规定，连入网络的计算机都须有【网卡接口】，数据包须从一块网卡到另一块网卡
    + 网卡的地址（【MAC地址】）便是数据包的发送和接收地址
    + MAC地址在网卡生产时被唯一标识
    + 通常用12个16进制表示，如：00-B0-D0-86-A7-A0
    + 前6个16进制是厂商编号，后6个是该厂商网卡流水号

#### 以太网数据包须知道接收方的MAC地址，然后才能发送。如何知道接收方的MAC地址？
ARP协议仅用于IPv4。IPv6使用Neighbor Discovery Protocol来替代ARP的功能。下面以ARP协议为例：
每一台主机和路由都能了解局域网内的IP地址和MAC地址对应的关系，通过ARP协议传播到局域网的每个主机和路由，让每个主机或路由中都有一个ARP cache，以实现IP地址与MAC地址对应。

流程如下：

+ 主机A发出一个ARP包，ARP包内含自己的IP地址、MAC地址、接收方的IP地址
+ 广播到局域网上的所有主机和路由
+ 同一局域网内的主机收到这个数据包之后，会取出接收方的IP地址与自身的对比
+ 相同，则把自己的MAC地址回复给对方
+ 不同，则丢弃这个数据包，并更新自己的ARP cache
+ 这样，计算机A就能知道计算机B（接收方）的MAC地址了。

根据上面的讲解，理论上依靠MAC地址和广播技术，上海的网卡发出的数据包可以找到洛杉矶网卡了——但是如果全世界的计算机都这么干，那么每一台计算机发出的数据包都同步广播到全世界其他电脑，再一一比对判断，这样显然是低效、不现实的。

#### 所有广播是指在发送者所在的局域网内广播的。那如何确定发送者和接收者是在同一局域网（子网）内？
网络地址（IP地址），规定网络地址的协议叫IP协议。

+ IP地址由网络部分和主机部分组成。若两台计算机的IP地址中的网络部分相同，则同一子网。
+ 处于同一子网的主机，它们的IP地址中的网络部分必相同。例：172.16.254.3 和 172.16.254.1处于同一子网。
+ 但从IP地址，无法确认网络部分是哪几位，哪如何确定两台主机是同一子网络？ 
    + 子网掩码，表示子网络特征的一个参数
    + 形式上等同IP地址，由32位二进制组成，其网络部分规定全部为1，主机部分规定全部为0
    + 任意两IP地址，通过子网掩码如何确定同一子网？
        + 方法是将两个IP地址与子网掩码分别进行AND运算（两个数位都为1，运算结果为1，否则为0）
        + 比较结果是否相同
        + 相同，表明它们在同一个子网络中
        + 不相同，则不是
        

#### 有了MAC地址和IP地址，如何准确把数据包送到接收方？
通过以上广播+MAC寻址流程，数据成功从A主机传到B主机。

+ B主机有各种各样的应用程序，计算机如何知道数据是给谁的呢？
    + 需要一个参数来区分，这个参数叫【端口号】
    + 每个数据包发送到主机的特定端口
    + 不同的程序便可取自己想要的数据包
    + 主机与端口号确定，便可实现程序之间的交流

**传输层的功能就是建立端口到端口的通信，网络层的功能是建立主机到主机的通信**

#### 应用层收到传输层的数据，根据数据格式解读渲染。

#### 不在同一局域网内的两主机，如何传输数据的呢？
+ 路由
    + 路由定义一条路径，经过因特网发送包到另一网络上的地址，但路由不定义完全路径，只定义从主机到可以将包转发到目的地的网关（子网）间的路径段（或从一个子网到另一个子网）。
+ 路由器
    + 连接两个或多个网络并提供路由功能的机器，称为路由器
+ 网关 
    + 网卡是计算机的一个硬件，接收和发送网络信息
    + 一台计算机可以有不止一个网卡，如笔记本有以太网卡和WiFi网卡
    + 计算机接收或发送信息时，须先决定用哪个网卡
    + 路由器可理解为一台配置有多个网卡的专用电脑，让网卡接入到不同的网络中
    + 网关，路由器的一种，指网络层使用的路由器，只有IP地址
    + 在今天很多局域网采用都是路由来接入网络，因此现在通常指的【网关就是路由器的IP】。
    + 虽然路由器上面有MAC地址和IP地址，但它并不能通过MAC地址工作，必须通过IP寻址。因此它是工作在网络层的设备
+ 网络交换机
    + 一个扩大网络的器材，能为子网中提供更多的连接端口，以便连接更多的电脑
+ 交换机与路由器的区别：
    + 工作层次不同
        + 交换机主要工作在数据链路层（第二层）
        + 路由器工作在网络层（第三层）
    + 转发依据不同
        + 交换机转发所依据的对象是：MAC地址。（物理地址）
        + 路由转发所依据的对象是：IP地址。（网络地址）
    + 主要功能不同
        + 交换机主要用于组建局域网，连接同属于一个(广播域)子网的所有设备，负责子网内部通信（广播）。
        + 路由主要功能是将由交换机组好的局域网相互连接起来，或者将他们接入Internet。
        + 交换机能做的，路由都能做。
        + 交换机不能分割广播域（子网），路由可以。
        + 路由还可以提供防火墙的功能。
        + 路由配置比交换机复杂。
        + 交换机虽然主要依靠MAC地址查找工作在数据链路层，但是他也可以有IP地址，这样就可以进行远程登录等操作了


通过以上知识梳理，现在从一个用户的角度自顶向下走一遍一个网络数据包的过程。假设本机参数如下：

    本机IP地址：192.168.1.12
    子网掩码：255.255.255.0
    网关的IP地址：192.168.1.1
    DNS的IP地址：1.2.3.4

在主机A上，打开浏览器，输入google.com，按回车。这表示浏览器向google发送一个网页请求的数据包，流程如下

+ A主机会向DNS服务器发送请求，获取DNS的IP地址（1.2.3.4）。向DNS（1.2.3.4）发送数据包，获取输入网址的IP地址，于是拿到了网址的IP地址（172.194.72.105）
+ 通过子网掩码（255.255.255.0）AND运算，对比两个IP地址，是否在同一子网内，
    + 假设结论是：不在同一子网下
        + 因此须通过网关IP地址（192.168.1.1）转发，数据包发送成功
    + 假设结论是：在同一子网下
        + 通过广播方式获取接受者的MAC地址，数据包发送成功
+ 抵达传输层，建立端口连接,根据TCP/UDP协议在数据包上添加端口号
+ 最后到应用层，根据数据格式做相应的解析
    
##### 关于计算机网络的更多思考：

+ 为什么有的时候网速慢，有时候网速快？
+ 为什么上网要有modem（俗称猫，专业术语是调制解调器）？
+ 校园网为什么要去联通or移动办理业务才能上网？
+ 如何屏蔽某网？
+ QQ/微信发送的消息为啥不会出错？
+ 如何从网页上下载文档？
+ 为何连不上校园网但是能连手机热点？



